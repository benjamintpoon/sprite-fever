<!-- canvas.html -->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Canvas Test</title>
</head>
<style>
	#canvas {
		border: 1px dotted #000;
		margin: 30px;
	}
	#color-picker {
		float: right;
		border: 1px solid #ccc;
		padding: 20px;
	}
	.swatch {
		height: 100px;
		width: 100px;
		border: 1px solid #ccc;
	}
	.black { background-color: #000;}
	.white { background-color: #fff;}
</style>
<body>

	<!-- <canvas id="canvas" width="100" height="100"></canvas> -->
	<canvas id="canvas"></canvas>
	<div id="color-picker">
		<div class="swatch black"></div>
		<div class="swatch white"></div>
	</div>

	<script type="text/javascript" src="jquery-1.11.1.min.js"></script>
	<script type="text/javascript">


		const TILE_SIZE = 30;
		const GRID_X = 16;
		const GRID_Y = 20;

		var canvas = document.getElementById("canvas");
		var ctx    = canvas.getContext("2d");
		var width = canvas.width = TILE_SIZE * GRID_X;
		var height = canvas.height = TILE_SIZE * GRID_Y;
		var imageData = ctx.getImageData(0, 0, width, height);

		const RED    = 'rgba(255,0,0,1)';
		const GREEN  = 'rgba(0,255,0,1)';
		const BLUE   = 'rgba(0,0,255,1)';
		const COLORS = [RED, GREEN ,BLUE];

		var selectedColor = 'rgba(0,0,0)';
		var colorCounter = 0;

		function Grid(width, height) {
			this.width = width;
			this.height = height;
			this.tiles = {};
		}

		Grid.prototype.initialize = function() {
			for (var r = 0; r < this.height; r++) {
				this.tiles[r] = {};
				for (var c = 0; c < this.width; c++) {
					this.tiles[r][c] = new Tile(c, r, randColor());
					this.tiles[r][c].render();
				}
			}
		}

		function Tile(x, y, color) {
			this.x = x;
			this.y = y;
			this.color = color || null;
		}

		Tile.prototype.render = function() {
			ctx.fillStyle = this.color;
			ctx.fillRect(
				this.x * TILE_SIZE, 
				this.y * TILE_SIZE, 
				TILE_SIZE, 
				TILE_SIZE);
		};

		var Grid = new Grid(GRID_X, GRID_Y);
		Grid.initialize();

		function randColor() {
			return COLORS[colorCounter++ % 3];
		}

		$(function(){

			var $grid = $("#canvas");

			$grid.on('mousedown', function(e) {
				// prevent default behavior
				// determine intial mouse position
				// determine which tile was clicked
				// set that tile's color to currentColor value
				e.preventDefault();

				var gridX = Math.floor((e.offsetX - 1)/ TILE_SIZE);
				var gridY = Math.floor((e.offsetY - 1)/ TILE_SIZE);
				var tile = Grid.tiles[gridY][gridX];
				tile.color = selectedColor;
				tile.render();
				
				// alert(gridX+ ", " + gridY);
			});

			$('.swatch').on('click', function(e) {
				selectedColor = $(this).css('background-color');
			});

		});
	</script>
</body>
</html>